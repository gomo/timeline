(function(a){Timeline={};if(Array.prototype.forEach===undefined){Array.prototype.forEach=function(e,d){for(var c=0,b=this.length;c<b;++c){e.call(d,this[c],c,this)}}}if(Object.create===undefined){Object.create=function(e,c){var b;if(typeof(e)!=="object"&&e!==null){throw new TypeError()}function d(){}d.prototype=e;b=new d();if(typeof(c)==="object"){for(var f in c){if(c.hasOwnProperty((f))){b[f]=c[f]}}}return b}}if(Object.getPrototypeOf===undefined){if(typeof"test".__proto__==="object"){Object.getPrototypeOf=function(b){return b.__proto__}}else{Object.getPrototypeOf=function(b){return b.constructor.prototype}}}Timeline.Util={};Timeline.Util.inherits=function(b,c){b.super_=c;b.prototype=Object.create(c.prototype)};Timeline.View=function(){this._element=a('<div class="'+this._getClassName()+'"></div>');this._element.appendTo("body").hide()};Timeline.View.prototype.getElement=function(){return this._element};Timeline.View.prototype._build=function(){};Timeline.View.prototype._position=function(){};Timeline.View.prototype.render=function(){this._build();this._element.show();this._position();return this._element};Timeline.EventView=function(c,b){Timeline.EventView.super_.call(this);this._timeSpan=c;this._lineView=null;this._element.css("position","relative");this._element.addClass(b);this._startMinView=null;this._endMinView=null};Timeline.Util.inherits(Timeline.EventView,Timeline.View);Timeline.EventView.CLASS_ELEM="tlEventView";Timeline.EventView.create=function(d,b,c){return new Timeline.EventView(Timeline.TimeSpan.create(d,b),c)};Timeline.EventView.prototype._getClassName=function(){return Timeline.EventView.CLASS_ELEM};Timeline.EventView.prototype.getTimeSpan=function(){return this._timeSpan};Timeline.EventView.prototype.setLineView=function(b){this._lineView=b;return this};Timeline.EventView.prototype.setStartMinView=function(b){this._startMinView=b;b.setEventView(this);return this};Timeline.EventView.prototype.setEndMinView=function(b){this._endMinView=b;b.setEventView(this);return this};Timeline.EventView.prototype._build=function(){this._lineView.getLineElement().append(this._element);return this._element};Timeline.EventView.prototype.updatePosition=function(){var b=this;setTimeout(function(){var d=b._startMinView.getTopPosition(b._timeSpan.getStartTime().getMin());var c=b._endMinView.getTopPosition(b._timeSpan.getEndTime().getMin());var e=b._element.offset();e.top=d;b._element.offset(e);b._element.height(c-d-1)},0)};Timeline.EventView.prototype._position=function(){this.updatePosition()};Timeline.HourView=function(c,b){Timeline.HourView.super_.call(this);this._hour=b;this._lineView=c;this._minViews=[]};Timeline.Util.inherits(Timeline.HourView,Timeline.View);Timeline.HourView.CLASS_ELEM="tlHourView";Timeline.HourView.prototype._getClassName=function(){return Timeline.HourView.CLASS_ELEM};Timeline.HourView.prototype.getHour=function(){return this._hour};Timeline.HourView.prototype.getMinView=function(c){var b;this._minViews.forEach(function(d){if(d.contains(c)){b=d}});return b};Timeline.HourView.prototype.updateHeightPerMin=function(b){this._minViews.forEach(function(c){c.updateHeightPerMin(b)});return this};Timeline.HourView.prototype.setHeightPerMin=function(b){this._minViews.forEach(function(c){c.setHeightPerMin(b)});return this};Timeline.HourView.prototype.getLineView=function(){return this._lineView};Timeline.HourView.prototype._build=function(){var e=15;var d=60/e;for(var c=0;c<d;c++){var b=new Timeline.MinView(this,c*e,e);this._minViews.push(b);this._element.append(b.render())}this._element.addClass("_"+this._hour)};Timeline.LineView=function(b){Timeline.LineView.super_.call(this);this._timeSpan=b;this._hourViews=[];this._eventViews=[];this._lineElement=null;this._hoursWrapper=null;this._rulerElement=null;this._lineWidth=60};Timeline.Util.inherits(Timeline.LineView,Timeline.View);Timeline.LineView.CLASS_ELEM="tlLineView";Timeline.LineView.DEFAULT_RULER_WIDTH=50;Timeline.LineView.prototype._getClassName=function(){return Timeline.LineView.CLASS_ELEM};Timeline.LineView.prototype.getLineElement=function(){return this._lineElement};Timeline.LineView.prototype._build=function(){this._lineElement=a('<div class="tlTimeline" />').appendTo(this._element);this._hoursWrapper=a('<div class="inner" />').appendTo(this._lineElement);var d=this._timeSpan.getStartTime().getHour();var b=this._timeSpan.getEndTime().getHour();while(true){var c=new Timeline.HourView(this,d);this._hoursWrapper.append(c.render());this._hourViews.push(c);if(d===b){break}d+=1;if(d==24){d=0}}};Timeline.LineView.prototype._position=function(){this._updateSize()};Timeline.LineView.prototype.addEventView=function(b){b.setLineView(this);var c=b.getTimeSpan();b.setStartMinView(this._getMinView(c.getStartTime()));b.setEndMinView(this._getMinView(c.getEndTime()));this._eventViews.push(b);b.render();return this};Timeline.LineView.prototype._getMinView=function(c){var b;this._hourViews.forEach(function(d){if(d.getHour()===c.getHour()){b=d.getMinView(c.getMin())}});return b};Timeline.LineView.prototype.updateLineWidth=function(b){this._lineWidth+=b;this._updateSize();return this};Timeline.LineView.prototype.setLineWidth=function(b){this._lineWidth=b;this._updateSize();return this};Timeline.LineView.prototype.updateHeightPerMin=function(b){this._hourViews.forEach(function(c){c.updateHeightPerMin(b)});this.refreshRulerHeight();return this};Timeline.LineView.prototype.setHeightPerMin=function(b){this._hourViews.forEach(function(c){c.setHeightPerMin(b)});this.refreshRulerHeight();return this};Timeline.LineView.prototype._updateSize=function(){var b=this;b._lineElement.width(b._lineWidth);if(b._rulerElement){b._element.width(b._lineWidth+Timeline.LineView.DEFAULT_RULER_WIDTH)}else{b._element.width(b._lineWidth)}setTimeout(function(){var c=b._hoursWrapper.height();b._lineElement.css({height:c,overflow:"hidden"})},0)};Timeline.LineView.prototype.enableRuler=function(){var b=this;b._element.addClass("hasRuler");b._rulerElement=a('<div class="tlRuler" />').prependTo(b._element);b._rulerElement.width(Timeline.LineView.DEFAULT_RULER_WIDTH);b._hourViews.forEach(function(d){var c=a('<div class="hour">'+d.getHour()+":00</div>");b._rulerElement.append(c);c.data("hourView",d);c.height(d.getElement().outerHeight())});b._updateSize()};Timeline.LineView.prototype.refreshRulerHeight=function(){var b=this;if(b._rulerElement===null){b._updateSize();return}b._rulerElement.children().each(function(){var c=a(this);var d=c.data("hourView");setTimeout(function(){c.height(d.getElement().outerHeight())},0)});b._updateSize()};Timeline.MinView=function(c,b,d){Timeline.MinView.super_.call(this);this._hourView=c;this._min=b;this._minUnit=d;this._heightPerMin=1;this._relatedEventView=null};Timeline.Util.inherits(Timeline.MinView,Timeline.View);Timeline.MinView.CLASS_ELEM="tlMinView";Timeline.MinView.prototype._getClassName=function(){return Timeline.MinView.CLASS_ELEM};Timeline.MinView.prototype.contains=function(d){var c=this._min===0?0:this._min;var b=this._min+this._minUnit-1;return c<=d&&d<=b};Timeline.MinView.prototype.getHourView=function(){return this._hourView};Timeline.MinView.prototype.getTopPosition=function(b){var d=this._element.offset();var c=(b%this._minUnit)/this._minUnit;return d.top+(this._element.outerHeight()*c)-1};Timeline.MinView.prototype.setEventView=function(b){this._relatedEventView=b};Timeline.MinView.prototype.updateHeightPerMin=function(b){var c=this._heightPerMin;c+=b;if(c<0.1){c=0.1}this.setHeightPerMin(c);return this};Timeline.MinView.prototype.setHeightPerMin=function(b){if(this._heightPerMin==b){return}this._heightPerMin=b;this._updateSize();if(this._relatedEventView){this._relatedEventView.updatePosition()}return this};Timeline.MinView.prototype._updateSize=function(){this._element.height(this._heightPerMin*this._minUnit)};Timeline.MinView.prototype._build=function(){this._element.addClass("_"+(this._min+this._minUnit));this._updateSize()};Timeline.RulerView=function(){Timeline.RulerView.super_.call(this)};Timeline.Util.inherits(Timeline.RulerView,Timeline.View);Timeline.RulerView.CLASS_ELEM="tlRulerView";Timeline.RulerView.prototype._getClassName=function(){return Timeline.RulerView.CLASS_ELEM};Timeline.RulerView.prototype._build=function(){this._lineView.getLineElement().append(this._element);return this._element};Timeline.RulerView.prototype._position=function(){};Timeline.TemplateView=function(){Timeline.TemplateView.super_.call(this)};Timeline.Util.inherits(Timeline.TemplateView,Timeline.View);Timeline.TemplateView.CLASS_ELEM="tlTemplateView";Timeline.TemplateView.prototype._getClassName=function(){return Timeline.TemplateView.CLASS_ELEM};Timeline.TemplateView.prototype._build=function(){this._lineView.getLineElement().append(this._element);return this._element};Timeline.TemplateView.prototype._position=function(){};Timeline.Time=function(b,c){this._hour=b===undefined?0:parseInt(b,10);this._min=c===undefined?0:parseInt(c,10)};Timeline.Time.prototype.getHour=function(){return this._hour};Timeline.Time.prototype.getMin=function(){return this._min};Timeline.Time.prototype.getDistance=function(d){var c=d.getHour();if(this._hour>c){c+=24}var b=c-this._hour;return(b*60)+(d.getMin()-this._min)};Timeline.TimeSpan=function(c,b){this._startTime=c;this._endTime=b};Timeline.TimeSpan.create=function(c,b){return new Timeline.TimeSpan(new Timeline.Time(c[0],c[1]),new Timeline.Time(b[0],b[1]))};Timeline.TimeSpan.prototype.getDistance=function(){return this._startTime.calcMinDistance(this._endTime)};Timeline.TimeSpan.prototype.getStartTime=function(){return this._startTime};Timeline.TimeSpan.prototype.getEndTime=function(){return this._endTime}})(jQuery);