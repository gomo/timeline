<!doctype html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport" />
    <link rel="stylesheet" href="../lib/timeline.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
    <script src="../lib/jquery.ui.touch-punch.min.js"></script>
    <script src="../lib/timeline.js"></script>
    <script>
        $(function(){
            var tl = Timeline;
            var frame = new tl.FrameView(new tl.TimeSpan(new tl.Time(10, 0), new tl.Time(25.0)));

            Timeline.MinView.HEIGHT = 1.2;
            Timeline.LineView.WIDTH = 62;
            Timeline.FrameView.RULER_INTERVAL = 4;

            $('#timeline').append(frame.render());

            $.each([
                {label:'label1', id:'__1'},
                {label:'label2', id:'__2'},
                {label:'label3', id:'__3'},
                {label:'label4', id:'__4'},
                {label:'label5', id:'__5'},
                {label:'label6', id:'__6'},
                {label:'label7', id:'__7'},
                {label:'label8', id:'__8'},
                {label:'label9', id:'__9'},
                {label:'label10', id:'__10'},
                {label:'label11', id:'__11'},
                {label:'label12', id:'__12'},
                {label:'label13', id:'__13'},
                {label:'label14', id:'__14'},
                {label:'label15', id:'__15'},
            ], function(){
                frame.addLine(this.id, this.label);
            });

            var clickActionSelect = $('#actions .click_action');
            var clickAction = clickActionSelect.val();
            clickActionSelect.change(function(){
                clickAction = clickActionSelect.val();
            });

            frame.addEventListener('didClickEventView', function(e, params){
                if(clickAction == 'float'){
                    params.eventView.toFloat();
                } else {
                    params.eventView.toFlexible();
                }
            });

            frame.addEventListener('didClickFloatingEventView', function(e, params){
                if(!params.check.suggestion){
                    alert('You can\'t');
                } else {
                    params.eventView.moveTo(params.check.suggestion, params.lineView);
                    if(confirm('OK')){
                        params.eventView.floatFix(params.check.suggestion);
                    } else {
                        params.eventView.floatCancel();
                    }
                }
            });

            frame.addEventListener('didClickFlexibleEventView', function(e, params){
                if(confirm('OK')){
                    params.eventView.flexibleFix();
                } else {
                    params.eventView.flexibleCancel();
                }
            });

            frame.addEventListener('didFixFloatingEventView', function(e, params){
                console.log('floatFix', params);
            });

            frame.addEventListener('didFixFlexibleEventView', function(e, params){
                console.log('flexibleFix', params);
            });

            frame.addEventView('__1', tl.EventView.create([10,0], [12,00], 'disable'));
            frame.addEventView('__1', tl.EventView.create([12,30], [14,30], 'green'));
            frame.addEventView('__2', tl.EventView.create([12,0], [13,30], 'pink'));
            frame.addEventView('__3', tl.EventView.create([10,0], [11,00], 'disable'));

            var fixInterval = $('#actions .fix_interval');
            fixInterval.val(frame.getMinFixInterval());
            fixInterval.change(function(){
                frame.setMinFixInterval(fixInterval.val());
            });

        });
    </script>
    <style>
        #wrapper{
            position: absolute;
            top: 100px;
            left: 100px;
            overflow: auto;
            width: 500px;
            height: 500px;
        }
    </style>
</head>
<body>
    <div id="wrapper" class="tlTimelineScrollWrapper">
        <div id="timeline"></div>
    </div>
</body>
</html>